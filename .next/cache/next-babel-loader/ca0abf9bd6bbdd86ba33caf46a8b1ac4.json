{"ast":null,"code":"var _jsxFileName = \"/Users/theo/frontend/pages/savingsDetail.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useCallback, useMemo } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport Web3 from \"web3\";\nimport { provider } from \"web3-core\";\nimport { CircularProgressbarWithChildren, buildStyles } from \"react-circular-progressbar\";\nimport numbro from \"numbro\";\nimport gql from \"graphql-tag\";\nimport moment from \"moment\";\nimport { useWallet } from \"use-wallet\";\nimport { useQuery } from \"@apollo/react-hooks\";\nimport useFarm from \"../hooks/useFarm\";\nimport useRedeem from \"../hooks/useRedeem\";\nimport useSushi from \"../hooks/useSushi\";\nimport useEarnings from \"../hooks/useEarnings\";\nimport useStake from \"../hooks/useStake\";\nimport useUnstake from \"../hooks/useUnstake\";\nimport useStakedBalance from \"../hooks/useStakedBalance\";\nimport useTokenBalance from \"../hooks/useTokenBalance\";\nimport useReward from \"../hooks/useReward\";\nimport useApprove from \"../hooks/useApprove\";\nimport useAllowance from \"../hooks/useAllowance\";\nimport useWindowSize from \"../hooks/useWindowSize\";\nimport withApollo from \"../utils/withApollo\";\nimport { getMasterChefContract } from \"../sushi/utils\";\nimport { getContract } from \"../utils/erc20\";\nimport { getBalanceNumber } from \"../utils/formatBalance\";\nimport Layout from \"../components/layout\";\nimport LayoutDashboard from \"../components/layoutDashboard\";\nimport CustomChart from \"../components/customChart\";\nimport StakingInput from \"../components/stakingInput\";\nimport ColorGuide from \"../styles/colorGuide\";\nimport styles from \"./index.module.css\";\n\nfunction SavingsDetail() {\n  const {\n    responsiveWidth,\n    responsiveHeight\n  } = useWindowSize();\n  const {\n    account\n  } = useWallet();\n  const {\n    0: currentTimeFrame,\n    1: setCurrentTimeFrame\n  } = useState(1);\n  const {\n    0: stakingBalance,\n    1: setStakingBalance\n  } = useState(\"0\");\n  const {\n    0: selectedAmount,\n    1: setSelectedAmount\n  } = useState(null);\n  const {\n    0: requestedApproval,\n    1: setRequestedApproval\n  } = useState(false);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const isMobileLayout = responsiveWidth < 650;\n  const {\n    query: {\n      farmId\n    }\n  } = useRouter();\n  const {\n    pid,\n    lpToken,\n    lpTokenAddress,\n    tokenAddress,\n    earnToken,\n    name,\n    icon\n  } = useFarm(farmId) || {\n    pid: 0,\n    lpToken: \"\",\n    lpTokenAddress: \"\",\n    tokenAddress: \"\",\n    earnToken: \"\",\n    name: \"\",\n    icon: \"\"\n  };\n  const QUERY = gql`\n    {\n      pairDayDatas(\n        first: 100\n        orderBy: date\n        orderDirection: asc\n        where: {\n          pairAddress: \"${lpTokenAddress}\"\n          date_gt: 1592505859\n        }\n      ) {\n        date\n        reserveUSD\n      }\n    }\n  `;\n  const {\n    loading: isLoadingQuery,\n    data: aggregateData\n  } = useQuery(QUERY);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n  const sushi = useSushi();\n  const earnings = useEarnings(pid);\n  const {\n    ethereum\n  } = useWallet();\n  const lpContract = useMemo(() => {\n    return getContract(ethereum, lpTokenAddress);\n  }, [ethereum, lpTokenAddress]);\n  const {\n    onStake\n  } = useStake(pid);\n  const {\n    onUnstake\n  } = useUnstake(pid);\n  const {\n    onReward\n  } = useReward(pid);\n  const {\n    onApprove\n  } = useApprove(lpContract);\n  const allowance = useAllowance(lpContract);\n  const tokenBalance = useTokenBalance(lpContract.options.address);\n  const stakedBalance = useStakedBalance(pid);\n  const {\n    onRedeem\n  } = useRedeem(getMasterChefContract(sushi));\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true);\n      const txHash = await onApprove();\n\n      if (!txHash) {\n        setRequestedApproval(false);\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }, [onApprove, setRequestedApproval]);\n  const lpTokenName = useMemo(() => {\n    return lpToken;\n  }, [lpToken]);\n  const earnTokenName = useMemo(() => {\n    return earnToken.toUpperCase();\n  }, [earnToken]);\n  const chartTimeFrame = [\"Total\", \"Aujourd'hui\"];\n  const formattedEarnings = numbro(getBalanceNumber(earnings) || 0).format({\n    average: true,\n    spaceSeparated: true,\n    thousandSeparated: true,\n    mantissa: 2\n  });\n  const keyIndicatorsList = [{\n    title: `Balance`,\n    value: `${numbro(getBalanceNumber(tokenBalance) || 0).format({\n      average: true,\n      mantissa: 2,\n      spaceSeparated: true\n    })}`\n  }, {\n    title: `Staked`,\n    value: `${numbro(getBalanceNumber(stakedBalance) || 0).format({\n      spaceSeparated: true,\n      thousandSeparated: true,\n      mantissa: 3\n    })}`\n  }, {\n    title: `Earnings ${earnToken}`,\n    value: `${formattedEarnings}`\n  }];\n  const stakedPercentage = getBalanceNumber(stakedBalance) * 100 / (getBalanceNumber(stakedBalance) + getBalanceNumber(tokenBalance));\n  const uniswapURL = `https://app.uniswap.org/#/add/${tokenAddress}/ETH`;\n  return __jsx(Layout, {\n    pageTitle: `Stake ${lpToken}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 5\n    }\n  }, __jsx(LayoutDashboard, {\n    currentTabIndex: 1,\n    sectionTitle: `Stake ${lpToken}`,\n    rightLink: {\n      title: \"Get LP token\",\n      link: uniswapURL\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"containerSpaceBetween notResponsive\",\n    style: {\n      marginBottom: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, keyIndicatorsList.map(({\n    title,\n    value\n  }, index) => __jsx(\"div\", {\n    key: index,\n    className: \"containerItem containerSpaceBetween\",\n    style: {\n      padding: isMobileLayout ? 10 : responsiveWidth < 1250 ? 20 : 25,\n      width: \"25%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 15\n    }\n  }, __jsx(\"p\", {\n    style: {\n      color: ColorGuide.mainGrey\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 17\n    }\n  }, title), __jsx(\"h3\", {\n    style: {\n      marginBottom: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 17\n    }\n  }, value))))), __jsx(\"div\", {\n    className: \"containerSpaceBetween\",\n    style: {\n      alignItems: \"flex-start\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    style: {\n      width: isMobileLayout ? \"100%\" : \"38%\",\n      minWidth: !isMobileLayout && 150,\n      maxWidth: !isMobileLayout && 350,\n      marginBottom: isMobileLayout && 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"containerItem\",\n    style: {\n      padding: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 13\n    }\n  }, !allowance.toNumber() ? __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginBottom: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 19\n    }\n  }, \"You didn't approve the pair \", lpToken, \" yet.\"), __jsx(\"button\", {\n    onClick: handleApprove,\n    style: {\n      width: \"100%\",\n      marginBottom: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 19\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 21\n    }\n  }, \"Approve the pair\"))) : __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: {\n      margin: \"auto\",\n      width: 100,\n      height: 100,\n      marginBottom: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 19\n    }\n  }, __jsx(CircularProgressbarWithChildren, {\n    value: !isNaN(stakedPercentage) ? stakedPercentage : 0,\n    strokeWidth: 15,\n    styles: buildStyles({\n      pathColor: ColorGuide.mainGreen,\n      textColor: \"#f88\",\n      trailColor: ColorGuide.lightGreen\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 21\n    }\n  }, __jsx(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 23\n    }\n  }, !isNaN(stakedPercentage) ? stakedPercentage : 0, \"%\"))), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 19\n    }\n  }, __jsx(\"input\", {\n    style: {\n      padding: 15\n    },\n    type: \"text\",\n    onChange: e => setSelectedAmount(e.target.value.replace(\",\", \".\")),\n    value: selectedAmount,\n    placeholder: \"Amount to stake\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 21\n    }\n  }), __jsx(\"button\", {\n    className: \"secondaryButton\",\n    style: {\n      position: \"absolute\",\n      top: 4,\n      right: 4,\n      paddingTop: 0,\n      paddingBottom: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 21\n    }\n  }, __jsx(\"p\", {\n    onClick: () => setNewAmount(currentTokenBalance),\n    style: {\n      color: ColorGuide.mainBlue\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 23\n    }\n  }, \"MAX\"))), __jsx(\"button\", {\n    onClick: () => {\n      onStake(selectedAmount);\n      setSelectedAmount(null);\n    },\n    style: {\n      width: \"100%\",\n      marginBottom: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 19\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 21\n    }\n  }, \"Stake amount\")), __jsx(\"button\", {\n    onClick: () => {\n      onUnstake(selectedAmount);\n      setSelectedAmount(null);\n    },\n    style: {\n      width: \"100%\",\n      backgroundColor: ColorGuide.lightBlue\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 19\n    }\n  }, __jsx(\"p\", {\n    style: {\n      color: ColorGuide.mainBlue\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 21\n    }\n  }, \"Withdraw amount\"))))), __jsx(\"div\", {\n    style: {\n      width: isMobileLayout ? \"100%\" : \"60%\",\n      minWidth: 150,\n      maxWidth: 1500\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 11\n    }\n  }, earnings > 0 && __jsx(\"button\", {\n    onClick: () => {\n      onReward();\n    },\n    style: {\n      width: \"100%\",\n      marginBottom: isMobileLayout ? 25 : 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 15\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 17\n    }\n  }, \"Get my reward (\", `${formattedEarnings}`, \") GT\")), !isLoadingQuery && __jsx(\"div\", {\n    className: \"containerItem\",\n    style: {\n      padding: 15\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 15\n    }\n  }, __jsx(CustomChart, {\n    aggregateData: aggregateData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 17\n    }\n  }))))));\n}\n\nexport default withApollo(SavingsDetail);","map":{"version":3,"sources":["/Users/theo/frontend/pages/savingsDetail.js"],"names":["React","useState","useEffect","useCallback","useMemo","Link","useRouter","Web3","provider","CircularProgressbarWithChildren","buildStyles","numbro","gql","moment","useWallet","useQuery","useFarm","useRedeem","useSushi","useEarnings","useStake","useUnstake","useStakedBalance","useTokenBalance","useReward","useApprove","useAllowance","useWindowSize","withApollo","getMasterChefContract","getContract","getBalanceNumber","Layout","LayoutDashboard","CustomChart","StakingInput","ColorGuide","styles","SavingsDetail","responsiveWidth","responsiveHeight","account","currentTimeFrame","setCurrentTimeFrame","stakingBalance","setStakingBalance","selectedAmount","setSelectedAmount","requestedApproval","setRequestedApproval","loading","setLoading","isMobileLayout","query","farmId","pid","lpToken","lpTokenAddress","tokenAddress","earnToken","name","icon","QUERY","isLoadingQuery","data","aggregateData","window","scrollTo","sushi","earnings","ethereum","lpContract","onStake","onUnstake","onReward","onApprove","allowance","tokenBalance","options","address","stakedBalance","onRedeem","handleApprove","txHash","e","console","log","lpTokenName","earnTokenName","toUpperCase","chartTimeFrame","formattedEarnings","format","average","spaceSeparated","thousandSeparated","mantissa","keyIndicatorsList","title","value","stakedPercentage","uniswapURL","link","marginBottom","map","index","padding","width","color","mainGrey","alignItems","minWidth","maxWidth","toNumber","margin","height","isNaN","pathColor","mainGreen","textColor","trailColor","lightGreen","position","target","replace","top","right","paddingTop","paddingBottom","setNewAmount","currentTokenBalance","mainBlue","backgroundColor","lightBlue"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,WAArC,EAAkDC,OAAlD,QAAiE,OAAjE;AAEA,OAAOC,IAAP,MAAiB,WAAjB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,SAASC,QAAT,QAAyB,WAAzB;AAEA,SACEC,+BADF,EAEEC,WAFF,QAGO,4BAHP;AAIA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,SAASC,SAAT,QAA0B,YAA1B;AACA,SAASC,QAAT,QAAyB,qBAAzB;AAEA,OAAOC,OAAP,MAAoB,kBAApB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AACA,OAAOC,WAAP,MAAwB,sBAAxB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AACA,OAAOC,UAAP,MAAuB,qBAAvB;AACA,OAAOC,gBAAP,MAA6B,2BAA7B;AACA,OAAOC,eAAP,MAA4B,0BAA5B;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,UAAP,MAAuB,qBAAvB;AACA,OAAOC,YAAP,MAAyB,uBAAzB;AACA,OAAOC,aAAP,MAA0B,wBAA1B;AAEA,OAAOC,UAAP,MAAuB,qBAAvB;AAEA,SAASC,qBAAT,QAAsC,gBAAtC;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,SAASC,gBAAT,QAAiC,wBAAjC;AAEA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,eAAP,MAA4B,+BAA5B;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,OAAOC,YAAP,MAAyB,4BAAzB;AAEA,OAAOC,UAAP,MAAuB,sBAAvB;AACA,OAAOC,MAAP,MAAmB,oBAAnB;;AAEA,SAASC,aAAT,GAAyB;AACvB,QAAM;AAAEC,IAAAA,eAAF;AAAmBC,IAAAA;AAAnB,MAAwCb,aAAa,EAA3D;AACA,QAAM;AAAEc,IAAAA;AAAF,MAAc3B,SAAS,EAA7B;AAEA,QAAM;AAAA,OAAC4B,gBAAD;AAAA,OAAmBC;AAAnB,MAA0C1C,QAAQ,CAAC,CAAD,CAAxD;AACA,QAAM;AAAA,OAAC2C,cAAD;AAAA,OAAiBC;AAAjB,MAAsC5C,QAAQ,CAAC,GAAD,CAApD;AACA,QAAM;AAAA,OAAC6C,cAAD;AAAA,OAAiBC;AAAjB,MAAsC9C,QAAQ,CAAC,IAAD,CAApD;AACA,QAAM;AAAA,OAAC+C,iBAAD;AAAA,OAAoBC;AAApB,MAA4ChD,QAAQ,CAAC,KAAD,CAA1D;AAEA,QAAM;AAAA,OAACiD,OAAD;AAAA,OAAUC;AAAV,MAAwBlD,QAAQ,CAAC,IAAD,CAAtC;AAEA,QAAMmD,cAAc,GAAGb,eAAe,GAAG,GAAzC;AAEA,QAAM;AACJc,IAAAA,KAAK,EAAE;AAAEC,MAAAA;AAAF;AADH,MAEFhD,SAAS,EAFb;AAIA,QAAM;AACJiD,IAAAA,GADI;AAEJC,IAAAA,OAFI;AAGJC,IAAAA,cAHI;AAIJC,IAAAA,YAJI;AAKJC,IAAAA,SALI;AAMJC,IAAAA,IANI;AAOJC,IAAAA;AAPI,MAQF7C,OAAO,CAACsC,MAAD,CAAP,IAAmB;AACrBC,IAAAA,GAAG,EAAE,CADgB;AAErBC,IAAAA,OAAO,EAAE,EAFY;AAGrBC,IAAAA,cAAc,EAAE,EAHK;AAIrBC,IAAAA,YAAY,EAAE,EAJO;AAKrBC,IAAAA,SAAS,EAAE,EALU;AAMrBC,IAAAA,IAAI,EAAE,EANe;AAOrBC,IAAAA,IAAI,EAAE;AAPe,GARvB;AAkBA,QAAMC,KAAK,GAAGlD,GAAI;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B6C,cAAe;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAfE;AAiBA,QAAM;AAAEP,IAAAA,OAAO,EAAEa,cAAX;AAA2BC,IAAAA,IAAI,EAAEC;AAAjC,MAAmDlD,QAAQ,CAAC+C,KAAD,CAAjE;AAEA5D,EAAAA,SAAS,CAAC,MAAM;AACdgE,IAAAA,MAAM,CAACC,QAAP,CAAgB,CAAhB,EAAmB,CAAnB;AACD,GAFQ,EAEN,EAFM,CAAT;AAIA,QAAMC,KAAK,GAAGlD,QAAQ,EAAtB;AACA,QAAMmD,QAAQ,GAAGlD,WAAW,CAACoC,GAAD,CAA5B;AAEA,QAAM;AAAEe,IAAAA;AAAF,MAAexD,SAAS,EAA9B;AAEA,QAAMyD,UAAU,GAAGnE,OAAO,CAAC,MAAM;AAC/B,WAAO0B,WAAW,CAACwC,QAAD,EAAWb,cAAX,CAAlB;AACD,GAFyB,EAEvB,CAACa,QAAD,EAAWb,cAAX,CAFuB,CAA1B;AAIA,QAAM;AAAEe,IAAAA;AAAF,MAAcpD,QAAQ,CAACmC,GAAD,CAA5B;AACA,QAAM;AAAEkB,IAAAA;AAAF,MAAgBpD,UAAU,CAACkC,GAAD,CAAhC;AACA,QAAM;AAAEmB,IAAAA;AAAF,MAAelD,SAAS,CAAC+B,GAAD,CAA9B;AACA,QAAM;AAAEoB,IAAAA;AAAF,MAAgBlD,UAAU,CAAC8C,UAAD,CAAhC;AACA,QAAMK,SAAS,GAAGlD,YAAY,CAAC6C,UAAD,CAA9B;AAEA,QAAMM,YAAY,GAAGtD,eAAe,CAACgD,UAAU,CAACO,OAAX,CAAmBC,OAApB,CAApC;AACA,QAAMC,aAAa,GAAG1D,gBAAgB,CAACiC,GAAD,CAAtC;AAEA,QAAM;AAAE0B,IAAAA;AAAF,MAAehE,SAAS,CAACY,qBAAqB,CAACuC,KAAD,CAAtB,CAA9B;AAEA,QAAMc,aAAa,GAAG/E,WAAW,CAAC,YAAY;AAC5C,QAAI;AACF8C,MAAAA,oBAAoB,CAAC,IAAD,CAApB;AACA,YAAMkC,MAAM,GAAG,MAAMR,SAAS,EAA9B;;AACA,UAAI,CAACQ,MAAL,EAAa;AACXlC,QAAAA,oBAAoB,CAAC,KAAD,CAApB;AACD;AACF,KAND,CAME,OAAOmC,CAAP,EAAU;AACVC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD;AACF,GAVgC,EAU9B,CAACT,SAAD,EAAY1B,oBAAZ,CAV8B,CAAjC;AAYA,QAAMsC,WAAW,GAAGnF,OAAO,CAAC,MAAM;AAChC,WAAOoD,OAAP;AACD,GAF0B,EAExB,CAACA,OAAD,CAFwB,CAA3B;AAIA,QAAMgC,aAAa,GAAGpF,OAAO,CAAC,MAAM;AAClC,WAAOuD,SAAS,CAAC8B,WAAV,EAAP;AACD,GAF4B,EAE1B,CAAC9B,SAAD,CAF0B,CAA7B;AAIA,QAAM+B,cAAc,GAAG,CAAC,OAAD,EAAU,aAAV,CAAvB;AAEA,QAAMC,iBAAiB,GAAGhF,MAAM,CAACoB,gBAAgB,CAACsC,QAAD,CAAhB,IAA8B,CAA/B,CAAN,CAAwCuB,MAAxC,CAA+C;AACvEC,IAAAA,OAAO,EAAE,IAD8D;AAEvEC,IAAAA,cAAc,EAAE,IAFuD;AAGvEC,IAAAA,iBAAiB,EAAE,IAHoD;AAIvEC,IAAAA,QAAQ,EAAE;AAJ6D,GAA/C,CAA1B;AAOA,QAAMC,iBAAiB,GAAG,CACxB;AACEC,IAAAA,KAAK,EAAG,SADV;AAEEC,IAAAA,KAAK,EAAG,GAAExF,MAAM,CAACoB,gBAAgB,CAAC8C,YAAD,CAAhB,IAAkC,CAAnC,CAAN,CAA4Ce,MAA5C,CAAmD;AAC3DC,MAAAA,OAAO,EAAE,IADkD;AAE3DG,MAAAA,QAAQ,EAAE,CAFiD;AAG3DF,MAAAA,cAAc,EAAE;AAH2C,KAAnD,CAIP;AANL,GADwB,EASxB;AACEI,IAAAA,KAAK,EAAG,QADV;AAEEC,IAAAA,KAAK,EAAG,GAAExF,MAAM,CAACoB,gBAAgB,CAACiD,aAAD,CAAhB,IAAmC,CAApC,CAAN,CAA6CY,MAA7C,CAAoD;AAC5DE,MAAAA,cAAc,EAAE,IAD4C;AAE5DC,MAAAA,iBAAiB,EAAE,IAFyC;AAG5DC,MAAAA,QAAQ,EAAE;AAHkD,KAApD,CAIP;AANL,GATwB,EAiBxB;AACEE,IAAAA,KAAK,EAAG,YAAWvC,SAAU,EAD/B;AAEEwC,IAAAA,KAAK,EAAG,GAAER,iBAAkB;AAF9B,GAjBwB,CAA1B;AAuBA,QAAMS,gBAAgB,GACnBrE,gBAAgB,CAACiD,aAAD,CAAhB,GAAkC,GAAnC,IACCjD,gBAAgB,CAACiD,aAAD,CAAhB,GAAkCjD,gBAAgB,CAAC8C,YAAD,CADnD,CADF;AAIA,QAAMwB,UAAU,GAAI,iCAAgC3C,YAAa,MAAjE;AAEA,SACE,MAAC,MAAD;AAAQ,IAAA,SAAS,EAAG,SAAQF,OAAQ,EAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,eAAD;AACE,IAAA,eAAe,EAAE,CADnB;AAEE,IAAA,YAAY,EAAG,SAAQA,OAAQ,EAFjC;AAGE,IAAA,SAAS,EAAE;AACT0C,MAAAA,KAAK,EAAE,cADE;AAETI,MAAAA,IAAI,EAAED;AAFG,KAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE;AACE,IAAA,SAAS,EAAC,qCADZ;AAEE,IAAA,KAAK,EAAE;AAAEE,MAAAA,YAAY,EAAE;AAAhB,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIGN,iBAAiB,CAACO,GAAlB,CAAsB,CAAC;AAAEN,IAAAA,KAAF;AAASC,IAAAA;AAAT,GAAD,EAAmBM,KAAnB,KACrB;AACE,IAAA,GAAG,EAAEA,KADP;AAEE,IAAA,SAAS,EAAC,qCAFZ;AAGE,IAAA,KAAK,EAAE;AACLC,MAAAA,OAAO,EAAEtD,cAAc,GAAG,EAAH,GAAQb,eAAe,GAAG,IAAlB,GAAyB,EAAzB,GAA8B,EADxD;AAELoE,MAAAA,KAAK,EAAE;AAFF,KAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAG,IAAA,KAAK,EAAE;AAAEC,MAAAA,KAAK,EAAExE,UAAU,CAACyE;AAApB,KAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA2CX,KAA3C,CADF,EAEE;AAAI,IAAA,KAAK,EAAE;AAAEK,MAAAA,YAAY,EAAE;AAAhB,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAiCJ,KAAjC,CAFF,CARF,CADD,CAJH,CARF,EA6BE;AACE,IAAA,SAAS,EAAC,uBADZ;AAEE,IAAA,KAAK,EAAE;AAAEW,MAAAA,UAAU,EAAE;AAAd,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIE;AACE,IAAA,KAAK,EAAE;AACLH,MAAAA,KAAK,EAAEvD,cAAc,GAAG,MAAH,GAAY,KAD5B;AAEL2D,MAAAA,QAAQ,EAAE,CAAC3D,cAAD,IAAmB,GAFxB;AAGL4D,MAAAA,QAAQ,EAAE,CAAC5D,cAAD,IAAmB,GAHxB;AAILmD,MAAAA,YAAY,EAAEnD,cAAc,IAAI;AAJ3B,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE;AACE,IAAA,SAAS,EAAC,eADZ;AAEE,IAAA,KAAK,EAAE;AACLsD,MAAAA,OAAO,EAAE;AADJ,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMG,CAAC9B,SAAS,CAACqC,QAAV,EAAD,GACC,4BACE;AAAG,IAAA,KAAK,EAAE;AAAEV,MAAAA,YAAY,EAAE;AAAhB,KAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAC+B/C,OAD/B,UADF,EAIE;AACE,IAAA,OAAO,EAAE0B,aADX;AAEE,IAAA,KAAK,EAAE;AAAEyB,MAAAA,KAAK,EAAE,MAAT;AAAiBJ,MAAAA,YAAY,EAAE;AAA/B,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAJF,CAJF,CADD,GAaC,4BACE;AACE,IAAA,KAAK,EAAE;AACLW,MAAAA,MAAM,EAAE,MADH;AAELP,MAAAA,KAAK,EAAE,GAFF;AAGLQ,MAAAA,MAAM,EAAE,GAHH;AAILZ,MAAAA,YAAY,EAAE;AAJT,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE,MAAC,+BAAD;AACE,IAAA,KAAK,EAAE,CAACa,KAAK,CAAChB,gBAAD,CAAN,GAA2BA,gBAA3B,GAA8C,CADvD;AAEE,IAAA,WAAW,EAAE,EAFf;AAGE,IAAA,MAAM,EAAE1F,WAAW,CAAC;AAClB2G,MAAAA,SAAS,EAAEjF,UAAU,CAACkF,SADJ;AAElBC,MAAAA,SAAS,EAAE,MAFO;AAGlBC,MAAAA,UAAU,EAAEpF,UAAU,CAACqF;AAHL,KAAD,CAHrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG,CAACL,KAAK,CAAChB,gBAAD,CAAN,GAA2BA,gBAA3B,GAA8C,CADjD,MATF,CARF,CADF,EAwBE;AAAK,IAAA,KAAK,EAAE;AAAEsB,MAAAA,QAAQ,EAAE;AAAZ,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,KAAK,EAAE;AAAEhB,MAAAA,OAAO,EAAE;AAAX,KADT;AAEE,IAAA,IAAI,EAAC,MAFP;AAGE,IAAA,QAAQ,EAAGtB,CAAD,IACRrC,iBAAiB,CAACqC,CAAC,CAACuC,MAAF,CAASxB,KAAT,CAAeyB,OAAf,CAAuB,GAAvB,EAA4B,GAA5B,CAAD,CAJrB;AAME,IAAA,KAAK,EAAE9E,cANT;AAOE,IAAA,WAAW,EAAC,iBAPd;AAQE,IAAA,QAAQ,MARV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAYE;AACE,IAAA,SAAS,EAAC,iBADZ;AAEE,IAAA,KAAK,EAAE;AACL4E,MAAAA,QAAQ,EAAE,UADL;AAELG,MAAAA,GAAG,EAAE,CAFA;AAGLC,MAAAA,KAAK,EAAE,CAHF;AAILC,MAAAA,UAAU,EAAE,CAJP;AAKLC,MAAAA,aAAa,EAAE;AALV,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAUE;AACE,IAAA,OAAO,EAAE,MAAMC,YAAY,CAACC,mBAAD,CAD7B;AAEE,IAAA,KAAK,EAAE;AAAEtB,MAAAA,KAAK,EAAExE,UAAU,CAAC+F;AAApB,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAVF,CAZF,CAxBF,EAuDE;AACE,IAAA,OAAO,EAAE,MAAM;AACb3D,MAAAA,OAAO,CAAC1B,cAAD,CAAP;AACAC,MAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACD,KAJH;AAKE,IAAA,KAAK,EAAE;AAAE4D,MAAAA,KAAK,EAAE,MAAT;AAAiBJ,MAAAA,YAAY,EAAE;AAA/B,KALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAPF,CAvDF,EAiEE;AACE,IAAA,OAAO,EAAE,MAAM;AACb9B,MAAAA,SAAS,CAAC3B,cAAD,CAAT;AACAC,MAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACD,KAJH;AAKE,IAAA,KAAK,EAAE;AACL4D,MAAAA,KAAK,EAAE,MADF;AAELyB,MAAAA,eAAe,EAAEhG,UAAU,CAACiG;AAFvB,KALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAUE;AAAG,IAAA,KAAK,EAAE;AAAEzB,MAAAA,KAAK,EAAExE,UAAU,CAAC+F;AAApB,KAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAVF,CAjEF,CAnBJ,CARF,CAJF,EAmHE;AACE,IAAA,KAAK,EAAE;AACLxB,MAAAA,KAAK,EAAEvD,cAAc,GAAG,MAAH,GAAY,KAD5B;AAEL2D,MAAAA,QAAQ,EAAE,GAFL;AAGLC,MAAAA,QAAQ,EAAE;AAHL,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAOG3C,QAAQ,GAAG,CAAX,IACC;AACE,IAAA,OAAO,EAAE,MAAM;AACbK,MAAAA,QAAQ;AACT,KAHH;AAIE,IAAA,KAAK,EAAE;AACLiC,MAAAA,KAAK,EAAE,MADF;AAELJ,MAAAA,YAAY,EAAEnD,cAAc,GAAG,EAAH,GAAQ;AAF/B,KAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAoB,GAAEuC,iBAAkB,EAAxC,SATF,CARJ,EAoBG,CAAC5B,cAAD,IACC;AAAK,IAAA,SAAS,EAAC,eAAf;AAA+B,IAAA,KAAK,EAAE;AAAE2C,MAAAA,OAAO,EAAE;AAAX,KAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,WAAD;AAAa,IAAA,aAAa,EAAEzC,aAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CArBJ,CAnHF,CA7BF,CADF,CADF;AAgLD;;AAED,eAAerC,UAAU,CAACU,aAAD,CAAzB","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from \"react\";\n\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport Web3 from \"web3\";\nimport { provider } from \"web3-core\";\n\nimport {\n  CircularProgressbarWithChildren,\n  buildStyles,\n} from \"react-circular-progressbar\";\nimport numbro from \"numbro\";\nimport gql from \"graphql-tag\";\nimport moment from \"moment\";\n\nimport { useWallet } from \"use-wallet\";\nimport { useQuery } from \"@apollo/react-hooks\";\n\nimport useFarm from \"../hooks/useFarm\";\nimport useRedeem from \"../hooks/useRedeem\";\nimport useSushi from \"../hooks/useSushi\";\nimport useEarnings from \"../hooks/useEarnings\";\nimport useStake from \"../hooks/useStake\";\nimport useUnstake from \"../hooks/useUnstake\";\nimport useStakedBalance from \"../hooks/useStakedBalance\";\nimport useTokenBalance from \"../hooks/useTokenBalance\";\nimport useReward from \"../hooks/useReward\";\nimport useApprove from \"../hooks/useApprove\";\nimport useAllowance from \"../hooks/useAllowance\";\nimport useWindowSize from \"../hooks/useWindowSize\";\n\nimport withApollo from \"../utils/withApollo\";\n\nimport { getMasterChefContract } from \"../sushi/utils\";\nimport { getContract } from \"../utils/erc20\";\nimport { getBalanceNumber } from \"../utils/formatBalance\";\n\nimport Layout from \"../components/layout\";\nimport LayoutDashboard from \"../components/layoutDashboard\";\nimport CustomChart from \"../components/customChart\";\nimport StakingInput from \"../components/stakingInput\";\n\nimport ColorGuide from \"../styles/colorGuide\";\nimport styles from \"./index.module.css\";\n\nfunction SavingsDetail() {\n  const { responsiveWidth, responsiveHeight } = useWindowSize();\n  const { account } = useWallet();\n\n  const [currentTimeFrame, setCurrentTimeFrame] = useState(1);\n  const [stakingBalance, setStakingBalance] = useState(\"0\");\n  const [selectedAmount, setSelectedAmount] = useState(null);\n  const [requestedApproval, setRequestedApproval] = useState(false);\n\n  const [loading, setLoading] = useState(true);\n\n  const isMobileLayout = responsiveWidth < 650;\n\n  const {\n    query: { farmId },\n  } = useRouter();\n\n  const {\n    pid,\n    lpToken,\n    lpTokenAddress,\n    tokenAddress,\n    earnToken,\n    name,\n    icon,\n  } = useFarm(farmId) || {\n    pid: 0,\n    lpToken: \"\",\n    lpTokenAddress: \"\",\n    tokenAddress: \"\",\n    earnToken: \"\",\n    name: \"\",\n    icon: \"\",\n  };\n\n  const QUERY = gql`\n    {\n      pairDayDatas(\n        first: 100\n        orderBy: date\n        orderDirection: asc\n        where: {\n          pairAddress: \"${lpTokenAddress}\"\n          date_gt: 1592505859\n        }\n      ) {\n        date\n        reserveUSD\n      }\n    }\n  `;\n\n  const { loading: isLoadingQuery, data: aggregateData } = useQuery(QUERY);\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const sushi = useSushi();\n  const earnings = useEarnings(pid);\n\n  const { ethereum } = useWallet();\n\n  const lpContract = useMemo(() => {\n    return getContract(ethereum, lpTokenAddress);\n  }, [ethereum, lpTokenAddress]);\n\n  const { onStake } = useStake(pid);\n  const { onUnstake } = useUnstake(pid);\n  const { onReward } = useReward(pid);\n  const { onApprove } = useApprove(lpContract);\n  const allowance = useAllowance(lpContract);\n\n  const tokenBalance = useTokenBalance(lpContract.options.address);\n  const stakedBalance = useStakedBalance(pid);\n\n  const { onRedeem } = useRedeem(getMasterChefContract(sushi));\n\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true);\n      const txHash = await onApprove();\n      if (!txHash) {\n        setRequestedApproval(false);\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }, [onApprove, setRequestedApproval]);\n\n  const lpTokenName = useMemo(() => {\n    return lpToken;\n  }, [lpToken]);\n\n  const earnTokenName = useMemo(() => {\n    return earnToken.toUpperCase();\n  }, [earnToken]);\n\n  const chartTimeFrame = [\"Total\", \"Aujourd'hui\"];\n\n  const formattedEarnings = numbro(getBalanceNumber(earnings) || 0).format({\n    average: true,\n    spaceSeparated: true,\n    thousandSeparated: true,\n    mantissa: 2,\n  });\n\n  const keyIndicatorsList = [\n    {\n      title: `Balance`,\n      value: `${numbro(getBalanceNumber(tokenBalance) || 0).format({\n        average: true,\n        mantissa: 2,\n        spaceSeparated: true,\n      })}`,\n    },\n    {\n      title: `Staked`,\n      value: `${numbro(getBalanceNumber(stakedBalance) || 0).format({\n        spaceSeparated: true,\n        thousandSeparated: true,\n        mantissa: 3,\n      })}`,\n    },\n    {\n      title: `Earnings ${earnToken}`,\n      value: `${formattedEarnings}`,\n    },\n  ];\n\n  const stakedPercentage =\n    (getBalanceNumber(stakedBalance) * 100) /\n    (getBalanceNumber(stakedBalance) + getBalanceNumber(tokenBalance));\n\n  const uniswapURL = `https://app.uniswap.org/#/add/${tokenAddress}/ETH`;\n\n  return (\n    <Layout pageTitle={`Stake ${lpToken}`}>\n      <LayoutDashboard\n        currentTabIndex={1}\n        sectionTitle={`Stake ${lpToken}`}\n        rightLink={{\n          title: \"Get LP token\",\n          link: uniswapURL,\n        }}\n      >\n        <div\n          className=\"containerSpaceBetween notResponsive\"\n          style={{ marginBottom: 20 }}\n        >\n          {keyIndicatorsList.map(({ title, value }, index) => (\n            <div\n              key={index}\n              className=\"containerItem containerSpaceBetween\"\n              style={{\n                padding: isMobileLayout ? 10 : responsiveWidth < 1250 ? 20 : 25,\n                width: \"25%\",\n              }}\n            >\n              <div>\n                <p style={{ color: ColorGuide.mainGrey }}>{title}</p>\n                <h3 style={{ marginBottom: 0 }}>{value}</h3>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <div\n          className=\"containerSpaceBetween\"\n          style={{ alignItems: \"flex-start\" }}\n        >\n          <div\n            style={{\n              width: isMobileLayout ? \"100%\" : \"38%\",\n              minWidth: !isMobileLayout && 150,\n              maxWidth: !isMobileLayout && 350,\n              marginBottom: isMobileLayout && 10,\n            }}\n          >\n            <div\n              className=\"containerItem\"\n              style={{\n                padding: 20,\n              }}\n            >\n              {!allowance.toNumber() ? (\n                <>\n                  <p style={{ marginBottom: 20 }}>\n                    You didn't approve the pair {lpToken} yet.\n                  </p>\n                  <button\n                    onClick={handleApprove}\n                    style={{ width: \"100%\", marginBottom: 10 }}\n                  >\n                    <p>Approve the pair</p>\n                  </button>\n                </>\n              ) : (\n                <>\n                  <div\n                    style={{\n                      margin: \"auto\",\n                      width: 100,\n                      height: 100,\n                      marginBottom: 20,\n                    }}\n                  >\n                    <CircularProgressbarWithChildren\n                      value={!isNaN(stakedPercentage) ? stakedPercentage : 0}\n                      strokeWidth={15}\n                      styles={buildStyles({\n                        pathColor: ColorGuide.mainGreen,\n                        textColor: \"#f88\",\n                        trailColor: ColorGuide.lightGreen,\n                      })}\n                    >\n                      <h4>\n                        {!isNaN(stakedPercentage) ? stakedPercentage : 0}%\n                      </h4>\n                    </CircularProgressbarWithChildren>\n                  </div>\n\n                  <div style={{ position: \"relative\" }}>\n                    <input\n                      style={{ padding: 15 }}\n                      type=\"text\"\n                      onChange={(e) =>\n                        setSelectedAmount(e.target.value.replace(\",\", \".\"))\n                      }\n                      value={selectedAmount}\n                      placeholder=\"Amount to stake\"\n                      required\n                    />\n\n                    <button\n                      className=\"secondaryButton\"\n                      style={{\n                        position: \"absolute\",\n                        top: 4,\n                        right: 4,\n                        paddingTop: 0,\n                        paddingBottom: 0,\n                      }}\n                    >\n                      <p\n                        onClick={() => setNewAmount(currentTokenBalance)}\n                        style={{ color: ColorGuide.mainBlue }}\n                      >\n                        MAX\n                      </p>\n                    </button>\n                  </div>\n\n                  <button\n                    onClick={() => {\n                      onStake(selectedAmount);\n                      setSelectedAmount(null);\n                    }}\n                    style={{ width: \"100%\", marginBottom: 10 }}\n                  >\n                    <p>Stake amount</p>\n                  </button>\n\n                  <button\n                    onClick={() => {\n                      onUnstake(selectedAmount);\n                      setSelectedAmount(null);\n                    }}\n                    style={{\n                      width: \"100%\",\n                      backgroundColor: ColorGuide.lightBlue,\n                    }}\n                  >\n                    <p style={{ color: ColorGuide.mainBlue }}>\n                      Withdraw amount\n                    </p>\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n\n          <div\n            style={{\n              width: isMobileLayout ? \"100%\" : \"60%\",\n              minWidth: 150,\n              maxWidth: 1500,\n            }}\n          >\n            {earnings > 0 && (\n              <button\n                onClick={() => {\n                  onReward();\n                }}\n                style={{\n                  width: \"100%\",\n                  marginBottom: isMobileLayout ? 25 : 10,\n                }}\n              >\n                <p>Get my reward ({`${formattedEarnings}`}) GT</p>\n              </button>\n            )}\n            {!isLoadingQuery && (\n              <div className=\"containerItem\" style={{ padding: 15 }}>\n                <CustomChart aggregateData={aggregateData} />\n              </div>\n            )}\n          </div>\n        </div>\n      </LayoutDashboard>\n    </Layout>\n  );\n}\n\nexport default withApollo(SavingsDetail);\n"]},"metadata":{},"sourceType":"module"}